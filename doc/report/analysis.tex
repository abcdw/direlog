\section{Представление задачи в терминах MapReduce}
Для распределённого запуска приложений была выбрана модель распределённых
вычислений MapReduce\footnotemark
\footnotetext{MapReduce — модель распределённых вычислений, представленная
  компанией Google, используемая для параллельных вычислений над очень
большими, несколько петабайт, наборами данных в компьютерных кластерах.}
по ряду причин.

Как оказалось задача без особых сложностей выражается в терминах
чистых функций flat map и flat reduce, так как основная структура,
используемая в алгоритме --- это пара(паттерн\footnotemark
\footnotetext{паттерн --- регулярное выражение},
количество совпадений) и благодаря этому однопоточный код легко запускается
на множестве нод MapReduce-кластера. Это обстоятельство освобождает
от реализации сложного механизма сетевого взаимодействия.

В качестве реализации модели MapReduce была выбрана реализация
Yandex Tables. Код программы, реализующий алгоритм легко переносится
на другие реализации данной модели распределённых вычислений.


\section{Выбор языка программирования и средств разработки}
В качестве среды разработки было решено использовать удалённую виртуальную
машину с конфигурацией и окружением идентичными конфигурации и окружению
MapReduce ноды. Были выбраны следующие программные продукты:

\begin{itemize}

\item В качестве операционной системы использовался дистрибутив GNU/Linux
  Ubuntu 12.04 LTS с модифицированным ядром и дополнительными пакетами.

\item Vim --- один из немногих несуществующих настоящих текстовых редакторов,
  обладающих массой встроенных возможностей и практически безграничным
  потенциалом к расширению за счёт встроенного интерпретируемого языка
  программирования VimL и поддержкой возможности написания расширений на
  таких языках, как python, ruby, perl.

\item Сохранение состояние рабочего окружения осуществлялось с помощью терминального
мультиплексора tmux, имеющего клиент-серверную архитектуру и
позволяющего отсоединятся от текущей сессии, оставляя её работать в фоновом
режиме с последующей возможностью переподключения.
tmux — свободная консольная утилита-мультиплексор,
предоставляющая пользователю доступ к нескольким терминалам в рамках
одного экрана. tmux может быть отключён от экрана: в этом случае он
продолжит исполняться в фоновом режиме; имеется возможность вновь
подключиться к tmux, находящемуся в фоне. tmux является штатным
мультиплексором терминалов операционной системы OpenBSD.
Программа tmux задумывалась как замена программы GNU Screen.

\item Удалённое подключение осуществлялось средствами защищённого протокола
ssh\\
(беспарольная аутентификация с использованием ключа) и технологии cauth.
SSH (англ. Secure Shell — ``безопасная оболочка'']) — сетевой протокол
прикладного уровня, позволяющий производить удалённое управление операционной
системой и туннелирование TCP-соединений (например, для передачи файлов).
Схож по функциональности с протоколами Telnet и rlogin, но, в отличие от них,
шифрует весь трафик, включая и передаваемые пароли. SSH допускает выбор
различных алгоритмов шифрования. SSH-клиенты и SSH-серверы доступны для
большинства сетевых операционных систем.

\item Для управления версиями исходных кодов использовалась децентрализованная
  система управления версиями git, в качестве hosting-провайдера был
  использован сервис github

\end{itemize}

В качестве языка программирования был выбран python2.7. Так как:

\begin{itemize}
\item Он предустановлен в большинстве современных дистрибутивах
  операционных систем.
\item Выразителен. Аналогичные программы на таких языках как Java, C++
  имеют в разы большие объёмы исходных кодов.
\item Обладает высокой производительностью.
\item Имеет множество библиотек, в том числе библиотеки для работы с
  регулярными выражениями, обёртки для MapReduce.

\end{itemize}

\section{Структура данных}
В качестве входных данных использовался агрегированный log-файл с нерегулярной
структурой, содержащий сообщения об ошибках в различных форматах, как
многострочные, так и однострочные.

Первая часть алгоритма, позволяет осуществить сбор статистики
и возвращает список пар (паттерн, количество совпадений), так же существует
возможность получить часть текста не удовлетворяющую известным паттернам,
для последующего анализа с помощью второй части алгоритма, позволяющей
выделить новые предполагаемые паттерны и с помощью первой части алгоритма
получить статистику, подтверждающую или опровергающую предположение.

\section{Стадии выполнения задачи}
\subsection{Подготовка репозитория}
Был создан git-репозиторий на сервисе github, сделана его локальная копия.
Была выбрана следующая структура проекта и правила именования файлов:

\begin{itemize}
\item В корневом каталоге лежат файлы README.md, LICENSE, .gitignore.
\item В каталоге doc/ хранится документация. Исходные тексты в \LaTeX и
  скомпилированная версия в PDF.
\item В каталоге direlog/ хранятся исходные коды с расширением .py и тесты,
  имеющие префикс test\_
\item В каталоге direlog/example/ хранятся примеры log-файлов и
  вспомогательные скрипты на языке bash.
\end{itemize}

\subsection{Выбор хранилища для паттернов}
В качестве хранилища для паттернов было решено использовать обычный файл на
языке python, названный patterns.py и содержащий в себе два списка паттернов
prepare\_patterns и main\_patterns, используемых на подготовительном этапе
и на этапе сбора статистики соответственно,
и хранить его под контролем версий в этом же репозитории. Причин
на это несколько: во-первых простота модификации файла с помощью скриптов,
во-вторых возможность просмотра истории изменений и откат к предыдущим версиям,
в-третьих возможность ручного редактирования.

\subsection{Написание программного кода}

Написание программного кода было разделено на несколько этапов.
\begin{enumerate}
\item Написание утилиты для предварительной обработки исходного log-файла.
  Утилита получила название prepare.py и позволила подготовить сырой log-файл
  для последующей обработки, путём замены уникальных токенов, таких
  как UUID, timestamp, версии, номера строк, пути, содержащие версии, на
  строковые константы.
\item Формирование prepare\_patterns на основе ручного анализа
  log-файлов.
\item Написание функциональных тестов для prepare.py.
\item Реализация алгоритма для сбора статистики с использованием
  main\_patterns. Утилита получила название direlog.py. И позволяет на
  выходе получить список пар (паттерн, количество совпадений) или текст,
  не подходящий под известные паттерны.
\item Добавление поддержки буферизации входного потока и поддержки
  многострочных паттернов.
\item Написание функциональных тестов для direlog.py.
\item Добавление функции, позволяющей запускать алгоритм на MapRedcue-кластере.
\end{enumerate}

